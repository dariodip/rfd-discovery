var app=angular.module("rfdApp",["ui.materialize","ngSanitize","ngFileUpload"]).config(["$interpolateProvider",function(a){a.startSymbol("[["),a.endSymbol("]]")}]);Object.map=function(a,b,c){c=c||this;var d={};return Object.keys(a).forEach(function(e){d[e]=b.call(c,a[e],e,a)}),d},Array.prototype.remove=function(a,b){var c=this.slice((b||a)+1||this.length);return this.length=a<0?this.length+a:a,this.push.apply(this,c)},Array.prototype.get=function(a){return this[a]},app.controller("appController",["$scope","$sce","Upload","$timeout",function(a,b,c,d){a.model=(a.initModel=function(){return{separator:";",missing:"?",semantic:!1,header:!0,selection:"0",datetime:"",sides:{lhs:[],rhs:[]}}})(),a.preview={},a.upload=function(b){a.loading=!0,a.model.file=b,b.upload=c.upload({url:"/api/upload",data:a.model}),b.upload.then(function(b){b.data.error?a.error=b.data.error:(a.result={mtxtime:b.data.mtxtime,total:b.data.total,timing:b.data.timing},a.result.data=Object.map(b.data.result,function(b,c,d){var e=b.split("\n");return e.map(function(b){return b.split(a.model.separator)})})),a.loading=!1},function(b){b.status>0&&(a.errorMsg=b.status+": "+b.data)},function(a){b.progress=Math.min(100,parseInt(100*a.loaded/a.total))})},a.resetComb=function(){a.model.sides.lhs=[],a.model.sides.rhs=[]},a.submit=function(){a.format_and_validation()&&a.upload(a.file)},a.range=function(a,b){for(var c=[],d=a;d<b;d++)c.push(d);return c},a.getComb=function(a){var b=JSON.parse(a);return Object.map(b,function(a,b){return a.join(", ")})},a.parseInt=parseInt,a.setTableData=function(){if(a.model.header)a.preview.ths=a._preview[0].split(a.model.separator),a.preview.trs=a._preview.slice(1).map(function(b){return b.split(a.model.separator)});else{var b=a._preview[0].split(a.model.separator).length;a.preview.ths=a.range(0,b),a.preview.trs=a._preview.map(function(b){return b.split(a.model.separator)})}},a.toggleLhs=function(b){var c=a.model.sides.lhs.indexOf(b);if(c>-1)a.model.sides.lhs.splice(c,1);else{a.model.sides.lhs.push(b);var d=a.model.sides.rhs.indexOf(b);d>-1&&(a.model.sides.rhs=[])}},a.setRhs=function(b){var c=a.model.sides.rhs.indexOf(b);if(a.model.sides.rhs=[],c===-1){a.model.sides.rhs.push(b);var d=a.model.sides.lhs.indexOf(b);d>-1&&a.model.sides.lhs.splice(d,1)}},a.format_and_validation=function(){return a.model.lhs=a.model.sides.lhs.join(","),a.model.rhs=a.model.sides.rhs.join(","),0!=a.model.selection||a.model.rhs?1!=a.model.selection||a.model.rhs&&a.model.lhs?(a.error=!1,!0):(a.error="Please select valids RHS and LHS",!1):(a.error="Please select valids RHS",!1)},$("#fileupload").bind("change",function(b){var c=b.target.files,d=c[0],e=new LineNavigator(d);a.details="FileType: "+(d.type||"n/a")+"<br />\n FileSize: "+d.size+" bytes<br />\n LastModified: "+(d.lastModifiedDate?d.lastModifiedDate.toLocaleDateString():"n/a")+"<br />\n",e.readLines(0,10,function(b,c,d,e,f){a._preview=d,a.setTableData(),a.$apply()}),a.model=a.initModel()})}]),app.directive("preloader",function(){return{restrict:"E",scope:!1,template:'<div class="preloader-wrapper active"><div class="spinner-layer spinner-red-only"><div class="circle-clipper left"><div class="circle"></div></div><div class="gap-patch"><div class="circle"></div></div><div class="circle-clipper right"><div class="circle"></div></div></div></div>'}});